general:
  artifacts:
    - target

machine:
  pre:
    - sudo pkill -u postgres
  java:
    version: oraclejdk8
  environment:
    TERM: dumb
    DEFAULT_JVM_OPTS: "-Xmx1024m -Xms512m"
    HADOOP_PROFILE: "hadoop2.7"
  post:
    - sudo pkill mongod
    - sudo pkill beam.smp
    - sudo pkill mysqld
    - sudo pkill postgres

checkout:
  post:
    - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
    - echo "user=$BINTRAY_USER" > .credentials
    - echo "password=$BINTRAY_PASSWORD" >> .credentials
    - echo "realm=Bintray API Realm" >> .credentials
    - echo "host=api.bintray.com" >> .credentials

dependencies:
  override:
    - ./build/sbt -Phadoop-2.7 -Pmesos -Pkinesis-asl -Pyarn -Phive-thriftserver -Phive update

test:
  override:
    - ./dev/run-tests

deployment:
  release:
    tag: /[0-9]+(?:\.[0-9]+)+-palantir[0-9]+/
    commands:
      - ./build/sbt -Phadoop-2.7 -Pmesos -Pkinesis-asl -Pyarn -Phive-thriftserver -Phive publish

